OntoRel 'https://griis.ca/PARS3-P4:v2.1/PARS3:v1.1';
Source 'https://griis.ca/JeDIS';

/* exclusions de l'OntoRel */
exclusion T01f6 NOT_AVAILABLE 'La clinique ne gère pas ces données là.';
exclusion T01f6 UNDEFINED 'À faire en 2022';

/* exclusions de la source */
exclusion "EXP"."LABORATOIRE"."COLUMN" 'Colonne non utilisée';

/* scalar laboratory result */
define T01ed_def for T01ed
  from "EXP"."LABORATOIRE"
  select "ID_LABORATOIRE_EXT"
;

/* scalar value specification */
define T00ce_def for T00ce
  from "EXP"."LABORATOIRE"
  select "ID_LABORATOIRE_EXT"
  /* where "PARS3"."V_upperRange"("EXP"."LABORATOIRE"."VALEUR") = 0
    and "PARS3"."V_lowerRange"("EXP"."LABORATOIRE"."VALEUR") = 0 */
;

/* scalar laboratory result has value specification [1..*] scalar value specification */
define T049d_def for T049d
  from T01ed_def
  natural join T00ce_def
  select T01ed_def.sign, T00ce_def.sign
;

/* scalar value specification has measurement value [1..*] double */
define T02c9_labo for T02c9
  from T00ce_def
  natural join "EXP"."LABORATOIRE"
  select T00ce_def.sign, /*"PARS3"."C_VARCHAR_NUMERIC_extract"(*/ "EXP"."LABORATOIRE"."VALEUR" /*)*/
  /*where "PARS3"."V_VARCHAR_NUMERIC_extract"("EXP"."LABORATOIRE"."VALEUR") = 1*/
;

/* frequency unit */
define T01f8_def for T01f8
  from expression «
    SELECT "ID_PRESCRIPTION_EXT"
    FROM "EXP"."PRESCRIPTION"
    JOIN "T01ed_def" USING ("ID_PATIENT_EXT") -- Inutile, mais intéressant à fin d'exemple. C'est ici que j'obligerais à qualifier avec un nom de schéma associé au mapping
    WHERE "TEXT_DOSAGE" IS NOT NULL
  »
  project ID_PRESCRIPTION_EXT
  using "EXP"."PRESCRIPTION"."ID_PRESCRIPTION_EXT"
  depending on "T01ed_def"
;

/* range value specification */
define T01ef_value for T01ef
  from "EXP"."LABORATOIRE"
  select "EXP"."LABORATOIRE"."ID_LABORATOIRE_EXT"
  where "ID_LABORATOIRE_EXT" IS NOT NULL
  /* and ("PARS3"."V_includedLowerRange"("EXP"."LABORATOIRE"."VALEUR") = 1
    or "PARS3"."V_includedUpperRange"("EXP"."LABORATOIRE"."VALEUR") = 1) */
;

/* fully specified range value specification */
define T01b4_value for T01b4
  from "EXP"."LABORATOIRE"
  select "ID_LABORATOIRE_EXT"
  where "ID_LABORATOIRE_EXT" IS NOT NULL
  /* AND "PARS3"."V_fullySpecifiedRange"("EXP"."LABORATOIRE"."VALEUR") = 1 */
;

/* fully specified range value specification */
define T01b4_normal for T01b4
  from "EXP"."LABORATOIRE"
  select "ID_LABORATOIRE_EXT"
    /* where "PARS3"."V_fullySpecifiedRange"("EXP"."LABORATOIRE"."REF_LABO") = 1 */
;

/* closed range value specification */
define T0209_value for T0209
  from "EXP"."LABORATOIRE"
  select "ID_LABORATOIRE_EXT"
  /*  where "PARS3"."V_includedLowerRange"("EXP"."LABORATOIRE"."VALEUR") = 1
    AND "PARS3"."V_includedUpperRange"("EXP"."LABORATOIRE"."VALEUR") = 1 */
;

/* closed range value specification */
define T0209_normal for T0209
  from "EXP"."LABORATOIRE"
  select "ID_LABORATOIRE_EXT"
  /* where "PARS3"."V_includedLowerRange"("EXP"."LABORATOIRE"."REF_LABO") = 1
  AND "PARS3"."V_includedUpperRange"("EXP"."LABORATOIRE"."REF_LABO") = 1 */
;

set shared(T01ef_value, T01b4_value, T0209_value);
set shared(T01b4_normal, T0209_normal);

set shadow(xx, yy);
